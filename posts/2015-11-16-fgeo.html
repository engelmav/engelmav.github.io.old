<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>the slow burn - Parsing regular records with a stackless state machine</title>
        <link rel="stylesheet" href="../css/default.css" />
    </head>
    <body>
        <div id="header">
            <div id="logo">
                <a href="../">the slow burn</a>
            </div>
            <div id="navigation">
                <a href="../">Home</a>
                <a href="../about.html">About</a>
                <a href="../contact.html">Contact</a>
                <a href="../archive.html">Archive</a>
            </div>
        </div>

        <div id="content">
            <h1>Parsing regular records with a stackless state machine</h1>
            <div class="info">
    Posted on November 16, 2015
    
        by Vincent Engelmann
    
</div>

<p>My uncle won a project to implement White Space broadband in Thurman, NY. One of the many interesting challenges was to determine where lots of “off the grid” residences existed. This would help him plan where he could put his whitespace repeaters.</p>
<p>We thought a bit about what information we had access to and determined that the tax rolls of the county would be useful. But we soon learned they were only available in semi-structured PDFs. This is how we parsed them:</p>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python"><span class="co"># ...</span>
START   <span class="op">=</span> <span class="st">'s'</span>
CONTENT <span class="op">=</span> <span class="st">'c'</span>

    <span class="kw">def</span> parseFile(<span class="va">self</span>, filename):
        state <span class="op">=</span> START
        recStart <span class="op">=</span> re.<span class="bu">compile</span>(<span class="st">'\*+'</span>) 
        <span class="va">self</span>.f <span class="op">=</span> <span class="va">None</span>
        <span class="va">self</span>.f <span class="op">=</span> <span class="bu">open</span>(filename, <span class="st">'r'</span>)
        <span class="cf">for</span> line <span class="kw">in</span> <span class="va">self</span>.f:
            <span class="cf">if</span> state <span class="kw">is</span> START <span class="kw">and</span> recStart.match(line):
                state <span class="op">=</span> <span class="st">'CONTENT'</span>
                <span class="va">self</span>.addressLines <span class="op">=</span> []
                <span class="va">self</span>.addressLines.append(<span class="va">self</span>.extractId(line))
                <span class="va">self</span>.addressLines.append(line)
            <span class="cf">elif</span> state <span class="kw">is</span> CONTENT <span class="kw">and</span>  <span class="kw">not</span> recStart.match(line):
                <span class="va">self</span>.addressLines.append(line)
            <span class="cf">elif</span> state <span class="kw">is</span> CONTENT <span class="kw">and</span>  recStart.match(line):
                state <span class="op">=</span> START
                <span class="va">self</span>.addressList.append(<span class="va">self</span>.addressLines)
                <span class="va">self</span>.addressLines <span class="op">=</span> []
                <span class="va">self</span>.addressLines.append(<span class="va">self</span>.extractId(line))
                <span class="va">self</span>.addressLines.append(line)
            <span class="cf">elif</span> state <span class="op">==</span> START <span class="kw">and</span> <span class="kw">not</span> recStart.match(line):
                state <span class="op">=</span> CONTENT
                <span class="va">self</span>.addressLines.append(line)
            <span class="cf">else</span>:
                <span class="bu">print</span> <span class="st">&quot;No valid state for given line.&quot;</span>
    <span class="kw">def</span> extractId(<span class="va">self</span>,line):
        <span class="cf">return</span> <span class="va">self</span>.recIdRgx.match(line).group(<span class="dv">1</span>)</code></pre></div>
CONTENT <span class="op">=</span> <span class="st">'c</span>

<span class="st">    def parseFile(self, filename):</span>
<span class="st">        state = START</span>
<span class="st">        recStart = re.compile('</span><span class="op">\*+</span><span class="st">') </span>
<span class="st">        self.f = None</span>
<span class="st">        self.f = open(filename, '</span><span class="vs">r')</span>
<span class="vs">        for line in self.f:</span>
<span class="vs">            if state is START and recStart.match(line):</span>
<span class="vs">                state = '</span>CONTENT<span class="st">'</span>
<span class="st">                self.addressLines = []</span>
<span class="st">                self.addressLines.append(self.extractId(line))</span>
<span class="st">                self.addressLines.append(line)</span>
<span class="st">            elif state is CONTENT and  not recStart.match(line):</span>
<span class="st">                self.addressLines.append(line)</span>
<span class="st">            elif state is CONTENT and  recStart.match(line):</span>
<span class="st">                state = START</span>
<span class="st">                self.addressList.append(self.addressLines)</span>
<span class="st">                self.addressLines = []</span>
<span class="st">                self.addressLines.append(self.extractId(line))</span>
<span class="st">                self.addressLines.append(line)</span>
<span class="st">            elif state == START and not recStart.match(line):</span>
<span class="st">                state = CONTENT</span>
<span class="st">                self.addressLines.append(line)</span>
<span class="st">            else:</span>
<span class="st">                print &quot;No valid state for given line.&quot;</span>
<span class="st">    def extractId(self,line):</span>
<span class="st">        return self.recIdRgx.match(line).group(1)</span></code></pre></div>

        </div>

        <div id="footer">
            Site proudly generated by
            <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </div>
    </body>
</html>
